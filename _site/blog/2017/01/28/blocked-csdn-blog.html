<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>被CSDN误判的博文，到底哪个是敏感信息啊？</title>
  <meta name="description" content="被CSDN误判的博文，全文原封不动贴在下面，到底哪个是敏感信息啊？">

  <link rel="stylesheet" href="//css/main.css">
  <link rel="canonical" href="http://localhost:4000//blog/2017/01/28/blocked-csdn-blog">
  <link rel="alternate" type="application/rss+xml" title="" href="http://localhost:4000//feed.xml">
  <link rel="icon" type="image/x-icon" href="http://localhost:4000/favicon.ico">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">

</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="//"></a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="//about/">About me</a>
          
        
          
          <a class="page-link" href="//blog/archive/">Archive</a>
          
        
          
          <a class="page-link" href="//blog/categories/">Categories</a>
          
        
          
        
          
        
          
        
          
          <a class="page-link" href="//blog/tags/">Tags</a>
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

<div id="status">
	<h1 class="post-title" itemprop="name headline">被CSDN误判的博文，到底哪个是敏感信息啊？</h1>
	<!-- <span>Jan 28, 2017  by <a href="http://localhost:4000/about">  </a></span> -->
	<span class="post-meta">
		<time datetime="2017-01-28T23:13:00+08:00" itemprop="datePublished">Jan 28, 2017</time>
		 by
		<span itemprop="author" itemscope itemtype="http://schema.org/Person">
			<span itemprop="name"><a href="http://localhost:4000/about">  </a>
			</span>
		</span>
		
	</span>

	

	

	
		<p class="category">
			<span class="post-meta"> Category：</span>
			
			  <a href="/#csdn" class="post-tag">CSDN</a>
			
		</p>
	

</div>
	<br>
<div id="post" class="post-content" itemprop="articleBody">
<p>被CSDN误判的博文，全文原封不动贴在下面，到底哪个是敏感信息啊？</p>

<p>———————-  分割线  ———————-</p>

<p><strong>Android中bindService的细节之三：多次调用bindService()，为什么onBind()只执行一次</strong></p>

<!--more-->

<h1 id="0-场景"><strong>0. 场景</strong></h1>

<p>为了更方便的说明问题，而又不失共性，本文中考虑下面两种情况：</p>

<ul>
  <li>
    <p><strong>情况一：</strong> App A绑定App B的service，App A多次调用bindService()，而不调用unbindService()，此时App B的service的onBind()只执行一次</p>
  </li>
  <li>
    <p><strong>情况二：</strong> App A，App C绑定App B的service，App A和App C各调用一次或多次bindService()，而不调用unbindService()，此时App B的service的onBind()只执行一次</p>
  </li>
</ul>

<p>上面提到的两种情况有2个共同点：</p>

<ul>
  <li>（1）每次调用bindService()时，绑定的服务是一样的；</li>
  <li>（2）没有调用unbindService()</li>
</ul>

<p>例如，下面的示例代码，设置intent中的包名和service名，是通过：</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">intent</span><span class="o">.</span><span class="na">setClassName</span><span class="o">(</span><span class="s">"com.galian.app_b"</span><span class="o">,</span> <span class="s">"com.galian.app_b.MyService"</span><span class="o">)</span>
</code></pre></div></div>
<p>com.galian.app_b是App B的包名；
com.galian.app_b.MyService是App B提供的Service。
这样App A绑定的服务和App C绑定的服务就是一样的了。</p>

<p>App A绑定App B的MyService的代码，如下：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">();</span>
    <span class="n">intent</span><span class="o">.</span><span class="na">setClassName</span><span class="o">(</span><span class="s">"com.galian.app_b"</span><span class="o">,</span> <span class="s">"com.galian.app_b.MyService"</span><span class="o">);</span>
    <span class="n">intent</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="s">"KEY_STRING"</span><span class="o">,</span> <span class="s">"From AppA!"</span><span class="o">);</span>
    <span class="n">intent</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="s">"KEY_INT"</span><span class="o">,</span> <span class="mi">42</span><span class="o">);</span>
    <span class="n">Uri</span> <span class="n">uri</span> <span class="o">=</span> <span class="n">Uri</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"content://com.galian.app_a/table"</span><span class="o">);</span>
    <span class="n">intent</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="s">"KEY_PARCEABLE"</span><span class="o">,</span> <span class="n">uri</span><span class="o">);</span>
    <span class="n">bindService</span><span class="o">(</span><span class="n">intent</span><span class="o">,</span> <span class="n">mSvcConn</span><span class="o">,</span> <span class="n">Context</span><span class="o">.</span><span class="na">BIND_AUTO_CREATE</span><span class="o">);</span>
</code></pre></div></div>

<p>App C绑定App B的MyService的代码，如下：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">();</span>
    <span class="n">intent</span><span class="o">.</span><span class="na">setClassName</span><span class="o">(</span><span class="s">"com.galian.app_b"</span><span class="o">,</span> <span class="s">"com.galian.app_b.MyService"</span><span class="o">);</span>
    <span class="n">intent</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="s">"KEY_STRING"</span><span class="o">,</span> <span class="s">"From AppC!"</span><span class="o">);</span>
    <span class="n">intent</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="s">"KEY_FLOAT"</span><span class="o">,</span> <span class="mf">42.0</span><span class="o">);</span>
    <span class="n">Uri</span> <span class="n">uri</span> <span class="o">=</span> <span class="n">Uri</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"content://com.galian.app_c/table"</span><span class="o">);</span>
    <span class="n">intent</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="s">"KEY_PARCEABLE"</span><span class="o">,</span> <span class="n">uri</span><span class="o">);</span>
    <span class="n">bindService</span><span class="o">(</span><span class="n">intent</span><span class="o">,</span> <span class="n">mSvcConn</span><span class="o">,</span> <span class="n">Context</span><span class="o">.</span><span class="na">BIND_AUTO_CREATE</span><span class="o">);</span>
</code></pre></div></div>

<p>App A 调用bindService()之后，等ServiceConnection的onServiceConnected()执行完，切换到App C，App C再调用bindService()，这时com.galian.app_b.MyService的onBind()只执行了一次。</p>

<p><strong>注意：</strong> 实际上可以有其他的方式可以让onBind()调用多次，本文中只讨论onBind()只执行一次的原因。</p>

<p>上面的场景中，为什么onBind()只执行一次？</p>

<p>关于bindService的基本流程，可以参考链接：</p>

<p><a href="http://blog.csdn.net/u013553529/article/details/54698123">《Android中bindService的细节之一：从进程的角度分析绑定Service的流程【Service所在进程首次启动】》</a></p>

<p><a href="http://blog.csdn.net/u013553529/article/details/54698123">《Android中bindService的细节之二：从进程的角度分析绑定Service的流程【Service所在进程已存在】》</a></p>

<p>本文中分析这种情况：App B进程之前已经启动。因为这样可以方便对比App A绑定服务和App C绑定服务的区别。否则，如果App B进程之前不存在，则App A绑定服务和App C绑定服务的流程首先会有App B进程创建流程的差别（关于这个差别，可以参考上面2个链接）。而这不是本文讨论的重点。</p>

<p><strong>再次说明本文分析的前提：App B进程已经存在，但是App B的服务MyService之前没有被绑定过。</strong></p>

<h1 id="1-关键的类intentbindrecord"><strong>1. 关键的类：IntentBindRecord</strong></h1>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">final</span> <span class="kd">class</span> <span class="nc">IntentBindRecord</span> <span class="o">{</span>
    <span class="cm">/** The running service. */</span>
    <span class="kd">final</span> <span class="n">ServiceRecord</span> <span class="n">service</span><span class="o">;</span>
    <span class="cm">/** The intent that is bound.*/</span>
    <span class="kd">final</span> <span class="n">Intent</span><span class="o">.</span><span class="na">FilterComparison</span> <span class="n">intent</span><span class="o">;</span>
    <span class="cm">/** All apps that have bound to this Intent. */</span>
    <span class="kd">final</span> <span class="n">ArrayMap</span><span class="o">&lt;</span><span class="n">ProcessRecord</span><span class="o">,</span> <span class="n">AppBindRecord</span><span class="o">&gt;</span> <span class="n">apps</span>
            <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayMap</span><span class="o">&lt;</span><span class="n">ProcessRecord</span><span class="o">,</span> <span class="n">AppBindRecord</span><span class="o">&gt;();</span>
    <span class="cm">/** Binder published from service. */</span>
    <span class="n">IBinder</span> <span class="n">binder</span><span class="o">;</span>
    <span class="cm">/** Set when we have initiated a request for this binder. */</span>
    <span class="kt">boolean</span> <span class="n">requested</span><span class="o">;</span>
    <span class="cm">/** Set when we have received the requested binder. */</span>
    <span class="kt">boolean</span> <span class="n">received</span><span class="o">;</span>
    <span class="cm">/** Set when we still need to tell the service all clients are unbound. */</span>
    <span class="kt">boolean</span> <span class="n">hasBound</span><span class="o">;</span>
    <span class="cm">/** Set when the service's onUnbind() has asked to be told about new clients. */</span>
    <span class="kt">boolean</span> <span class="n">doRebind</span><span class="o">;</span>
    <span class="o">...</span>
    <span class="o">...</span>
<span class="o">}</span>
</code></pre></div></div>

<p>IntentBindRecord是一个关键的类，它记录着以下信息：</p>

<ul>
  <li>
    <p>（1）ServiceRecord service： 被绑定的服务的ServiceRecord；</p>
  </li>
  <li>
    <p>（2）Intent.FilterComparison intent：绑定服务时的intent。绑定服务时，将bindService()的intent与IntentBindRecord中的intent进行比较，如果服务已经绑定（received为true），且intent能匹配上（FilterComparison的equals()返回true），则直接返回binder（IntentBindRecord中的IBinder binder），这些内容后面会详细讲。</p>
  </li>
  <li>
    <p>（3）ArrayMap&lt;ProcessRecord, AppBindRecord&gt; apps：使用相同Intent.FilterComparison intent的所有apps</p>
  </li>
  <li>
    <p>（4）IBinder binder：这是第一次绑定服务成功后，onBind()返回来的IBinder，通过publishService()传过来的。</p>
  </li>
  <li>
    <p>（5）boolean requested：标志位，requested为true表示绑定服务的请求已经发出了，是与<code class="highlighter-rouge">r.app.thread.scheduleBindService()</code>对应的（r为ServiceRecord实例），即调用<code class="highlighter-rouge">r.app.thread.scheduleBindService()</code>之后，通常要将requested置为true，以避免重复调用<code class="highlighter-rouge">r.app.thread.scheduleBindService()</code>。
如果doRebind为true，调用<code class="highlighter-rouge">r.app.thread.scheduleBindService()</code>之后，不会将requested置为true。</p>
  </li>
  <li>
    <p>（6）boolean received：标志位，received为true表示App B已经将onBind()返回的binder传给了AMS。是与IBinder binder同时起作用的。</p>
  </li>
  <li>
    <p>（7）boolean hasBound：表示是否有client绑定此服务。这里的client具体来说就是某一个Activity。</p>
  </li>
  <li>
    <p>（8）boolean doRebind：Service的<code class="highlighter-rouge">onUnbind()</code>的返回值为true时，将通过AMS的<code class="highlighter-rouge">unbindFinished()</code>传给AMS，记录在doRebind标志位中。下一次再有client绑定服务时，将根据doRebind的值来决定是调用onBind()，还是调用onRebind()。具体代码见：
handleBindService() @ ActivityThread.java</p>
    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">handleBindService</span><span class="o">(</span><span class="n">BindServiceData</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">Service</span> <span class="n">s</span> <span class="o">=</span> <span class="n">mServices</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">data</span><span class="o">.</span><span class="na">token</span><span class="o">);</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">s</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
          <span class="o">...</span>
          <span class="k">if</span> <span class="o">(!</span><span class="n">data</span><span class="o">.</span><span class="na">rebind</span><span class="o">)</span> <span class="o">{</span>
          	<span class="c1">// 如果之前onUnbind()返回false，则执行onBind()。（如果不重写onUnbind()，默认返回false）</span>
              <span class="n">IBinder</span> <span class="n">binder</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="na">onBind</span><span class="o">(</span><span class="n">data</span><span class="o">.</span><span class="na">intent</span><span class="o">);</span>
              <span class="o">...</span>
          <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
          	<span class="c1">// 如果之前onUnbind()返回true，则执行onRebind()。</span>
              <span class="n">s</span><span class="o">.</span><span class="na">onRebind</span><span class="o">(</span><span class="n">data</span><span class="o">.</span><span class="na">intent</span><span class="o">);</span>
              <span class="o">...</span>
          <span class="o">}</span>
          <span class="o">...</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></div>    </div>
  </li>
</ul>

<p>如果对这个类的成员变量还是模糊，也不要紧，后面还会在具体流程中提到。</p>

<h1 id="2-app-a绑定app-b的服务myservice"><strong>2. App A绑定App B的服务MyService</strong></h1>

<p><strong>执行流程大致是这样的：</strong></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bindService() @ ContextImpl
-&gt; bindService() @ AMS
-&gt; bindServiceLocked() @ ActiveServices
-&gt; retrieveServiceLocked() @ ActiveServices
根据intent获取service组件信息，返回service对应的ServiceRecord

-&gt; AppBindRecord b = s.retrieveAppBindingLocked(service, callerApp);
参数service是intent。这是本文讨论的重点。后面详细说。

-&gt; bringUpServiceLocked()
	if (r.app != null &amp;&amp; r.app.thread != null) {
        sendServiceArgsLocked(r, execInFg, false);
        return null;
    }
需要注意这段代码，r为ServiceRecord实例。r.app为ProcessRecord实例，r.app.thread为实现IApplicationThread接口的实例。
r.app是在执行realStartServiceLocked()时赋值的，所以此时r.app是null。


-&gt; realStartServiceLocked()
-&gt; app.thread.scheduleCreateService()
此处会出现并行处理的情形，即AMS进程继续执行，同时App B进程处理CREATE_SERVICE消息，即handleCreateService()。

-&gt; requestServiceBindingsLocked()
-&gt; requestServiceBindingLocked()
-&gt; r.app.thread.scheduleBindService()
此处会出现并行处理的情形，即AMS进程继续执行，同时App B进程处理BIND_SERVICE消息，即handleBindService()。需要注意的是，BIND_SERVICE消息是在CREATE_SERVICE消息处理完之后才能处理，因为这两个消息放入了消息队列，队列先入先出。所以handleBindService()的执行是在handleCreateService()之后。

-&gt; i.requested = true;
i.hasBound = true;  // 已经有client绑定服务，所以hasBound置为true
i.doRebind = false;  // 默认为false
i为IntentBindRecord实例，在此情景中，执行完r.app.thread.scheduleBindService()，就把requested置为true，这个requested值将在后面的流程中判断。

-&gt; 回到调用bringUpServiceLocked()方法的地方（在bindServiceLocked()中），继续执行bringUpServiceLocked()之后的代码

-&gt; 执行下面的代码 （在bindServiceLocked()中）
	if (s.app != null &amp;&amp; b.intent.received) {
        try {
            c.conn.connected(s.name, b.intent.binder);
        }...
        ...
    } else if (!b.intent.requested) {
        requestServiceBindingLocked(s, b.intent, callerFg, false);
    }
这段代码也是本文分析的重点，留待后面详细说明。

-&gt; handleCreateService() @ ActivityThread
handleCreateService()运行在App B进程中，是与AMS进程并行执行的，但是从代码的执行来看，handleCreateService()不会很快执行完，所以放在这里来理解也没有问题。

-&gt; handleBindService() @ ActivityThread
运行在App B进程中。肯定是在handleCreateService()执行完才执行的。
这也是本文分析的重点。后面会详细分析。

</code></pre></div></div>

<h2 id="21-重点代码1retrieveappbindinglocked"><strong>2.1 重点代码1：retrieveAppBindingLocked()</strong></h2>

<p>retrieveAppBindingLocked() @ ServiceRecord</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    public AppBindRecord retrieveAppBindingLocked(Intent intent,
            ProcessRecord app) {
        Intent.FilterComparison filter = new Intent.FilterComparison(intent);
        IntentBindRecord i = bindings.get(filter);
        if (i == null) {
        	// 执行这里
            i = new IntentBindRecord(this, filter);
            bindings.put(filter, i);
        }
        AppBindRecord a = i.apps.get(app);
        if (a != null) {
            return a;
        }
        a = new AppBindRecord(this, i, app);
        i.apps.put(app, a);
        return a;
    }
</code></pre></div></div>
<p>retrieveAppBindingLocked()根据intent来查询服务是否已经被绑定了，对应的代码是<code class="highlighter-rouge">IntentBindRecord i = bindings.get(filter)</code>。</p>

<p>在本文讨论的场景中App A是第一个绑定Myservice的，所以<code class="highlighter-rouge">bindings.get(filter)</code>的结果为null，需要创建新的IntentBindRecord。</p>

<p>需要说明的是，<code class="highlighter-rouge">bindings.get(filter)</code>，get的过程中，需要判断bindings中的intent与filter这个intent是否相同，这种intent的比较都是由Intent.FilterComparison类来完成的。
Intent类本身并没有重写<code class="highlighter-rouge">equals()</code>方法，所以不能用来判断intent是否相同。</p>

<p>Intent.FilterComparison重写了<code class="highlighter-rouge">equals()</code>方法，如下：
equals() @ FilterComparison @ Intent</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    @Override
    public boolean equals(Object obj) {
        if (obj instanceof FilterComparison) {
            Intent other = ((FilterComparison)obj).mIntent;
            return mIntent.filterEquals(other);
        }
        return false;
    }
</code></pre></div></div>

<p>filterEquals() @ Intent</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">filterEquals</span><span class="o">(</span><span class="n">Intent</span> <span class="n">other</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">other</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="c1">// 比较Intent中的各项指标：Action，Uri，MIME type，包名，Component，Category</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">mAction</span><span class="o">,</span> <span class="n">other</span><span class="o">.</span><span class="na">mAction</span><span class="o">))</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">mData</span><span class="o">,</span> <span class="n">other</span><span class="o">.</span><span class="na">mData</span><span class="o">))</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">mType</span><span class="o">,</span> <span class="n">other</span><span class="o">.</span><span class="na">mType</span><span class="o">))</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">mPackage</span><span class="o">,</span> <span class="n">other</span><span class="o">.</span><span class="na">mPackage</span><span class="o">))</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">mComponent</span><span class="o">,</span> <span class="n">other</span><span class="o">.</span><span class="na">mComponent</span><span class="o">))</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">mCategories</span><span class="o">,</span> <span class="n">other</span><span class="o">.</span><span class="na">mCategories</span><span class="o">))</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>

        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>
</code></pre></div></div>

<h2 id="22-重点代码2对intentbindrecord中的标志位进行判断"><strong>2.2 重点代码2：对IntentBindRecord中的标志位进行判断</strong></h2>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="k">if</span> <span class="o">(</span><span class="n">s</span><span class="o">.</span><span class="na">app</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">b</span><span class="o">.</span><span class="na">intent</span><span class="o">.</span><span class="na">received</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">c</span><span class="o">.</span><span class="na">conn</span><span class="o">.</span><span class="na">connected</span><span class="o">(</span><span class="n">s</span><span class="o">.</span><span class="na">name</span><span class="o">,</span> <span class="n">b</span><span class="o">.</span><span class="na">intent</span><span class="o">.</span><span class="na">binder</span><span class="o">);</span>
        <span class="o">}...</span>
        <span class="o">...</span>
    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(!</span><span class="n">b</span><span class="o">.</span><span class="na">intent</span><span class="o">.</span><span class="na">requested</span><span class="o">)</span> <span class="o">{</span>
	<span class="c1">// 不执行这里</span>
        <span class="n">requestServiceBindingLocked</span><span class="o">(</span><span class="n">s</span><span class="o">,</span> <span class="n">b</span><span class="o">.</span><span class="na">intent</span><span class="o">,</span> <span class="n">callerFg</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
    <span class="o">}</span>
</code></pre></div></div>
<p>s为ServiceRecord实例。s.app为ProcessRecord实例
b为AppBindRecord实例，
b.intent为IntentBindRecord实例。
这里对IntentBindRecord实例中的received和requested进行判断。</p>

<p>b.intent.received的赋值：只有在service的onBind()执行完，执行publishService()之后才会将received置为true。这是还没有执行到publishService()，所以received为false。</p>

<p>从前面的流程可以看到，b.intent.requested已经被置为true。</p>

<p>所以，对于App A绑定App B的服务的场景中，上面的代码什么也没做。
啥都没做，咋是重点代码呢？为了与App C绑定服务的情况进行对比。因为App C也会执行这段代码，而且是要执行c.conn.connected()的。</p>

<h2 id="23-重点代码3handlebindservice"><strong>2.3 重点代码3：handleBindService()</strong></h2>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">handleBindService</span><span class="o">(</span><span class="n">BindServiceData</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Service</span> <span class="n">s</span> <span class="o">=</span> <span class="n">mServices</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">data</span><span class="o">.</span><span class="na">token</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">s</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
            	<span class="o">...</span>
                <span class="k">try</span> <span class="o">{</span>
                    <span class="k">if</span> <span class="o">(!</span><span class="n">data</span><span class="o">.</span><span class="na">rebind</span><span class="o">)</span> <span class="o">{</span>
                    	<span class="c1">// 执行这里</span>
                        <span class="c1">// data.token是service对应的ServiceRecord</span>
                        <span class="n">IBinder</span> <span class="n">binder</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="na">onBind</span><span class="o">(</span><span class="n">data</span><span class="o">.</span><span class="na">intent</span><span class="o">);</span>
                        <span class="n">ActivityManagerNative</span><span class="o">.</span><span class="na">getDefault</span><span class="o">().</span><span class="na">publishService</span><span class="o">(</span>
                                <span class="n">data</span><span class="o">.</span><span class="na">token</span><span class="o">,</span> <span class="n">data</span><span class="o">.</span><span class="na">intent</span><span class="o">,</span> <span class="n">binder</span><span class="o">);</span>
                    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                    	<span class="c1">// 在此场景中，不执行这里</span>
                        <span class="n">s</span><span class="o">.</span><span class="na">onRebind</span><span class="o">(</span><span class="n">data</span><span class="o">.</span><span class="na">intent</span><span class="o">);</span>
                        <span class="o">...</span>
                    <span class="o">}</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">...</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">...</span>
        <span class="o">}</span>
    <span class="o">}</span>
</code></pre></div></div>

<p>执行onBind()返回binder对象，然后将此binder对象通过publishService()传给AMS。</p>

<p>publishService() @ AMS</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">publishService</span><span class="o">(</span><span class="n">IBinder</span> <span class="n">token</span><span class="o">,</span> <span class="n">Intent</span> <span class="n">intent</span><span class="o">,</span> <span class="n">IBinder</span> <span class="n">service</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">synchronized</span><span class="o">(</span><span class="k">this</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">mServices</span><span class="o">.</span><span class="na">publishServiceLocked</span><span class="o">((</span><span class="n">ServiceRecord</span><span class="o">)</span><span class="n">token</span><span class="o">,</span> <span class="n">intent</span><span class="o">,</span> <span class="n">service</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
</code></pre></div></div>

<p>publishServiceLocked() @ ActiveServices</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kt">void</span> <span class="nf">publishServiceLocked</span><span class="o">(</span><span class="n">ServiceRecord</span> <span class="n">r</span><span class="o">,</span> <span class="n">Intent</span> <span class="n">intent</span><span class="o">,</span> <span class="n">IBinder</span> <span class="n">service</span><span class="o">)</span> <span class="o">{</span>
    	<span class="cm">/* Binder.clearCallingIdentity()的目的是:
        	切换进程后，要提升执行代码的权限，将此时执行代码的权限提升为AMS，
            否则还是调用方App B的权限，这里的权限是指uid、pid对应的权限。
        */</span>
        <span class="kd">final</span> <span class="kt">long</span> <span class="n">origId</span> <span class="o">=</span> <span class="n">Binder</span><span class="o">.</span><span class="na">clearCallingIdentity</span><span class="o">();</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">r</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">Intent</span><span class="o">.</span><span class="na">FilterComparison</span> <span class="n">filter</span>
                        <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">.</span><span class="na">FilterComparison</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
                <span class="c1">// r.bindings.get(filter)返回不为null，因为之前创建了IntentBindRecord</span>
                <span class="c1">// b.received初始值是false</span>
                <span class="n">IntentBindRecord</span> <span class="n">b</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="na">bindings</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">filter</span><span class="o">);</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">b</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">b</span><span class="o">.</span><span class="na">received</span><span class="o">)</span> <span class="o">{</span>
                	<span class="c1">// 执行这里</span>
                    <span class="cm">/*更新IntentBindRecord中的数据，b.binder更新为onBind()返回的binder对象；b.requested更新为true，表示绑定请求已经处理了；b.received更新为true，表示binder对象已经收到了，目的是下次不用再调用onBind()了，这在App C绑定服务时会介绍。*/</span>
                    <span class="n">b</span><span class="o">.</span><span class="na">binder</span> <span class="o">=</span> <span class="n">service</span><span class="o">;</span>
                    <span class="n">b</span><span class="o">.</span><span class="na">requested</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                    <span class="n">b</span><span class="o">.</span><span class="na">received</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">conni</span><span class="o">=</span><span class="n">r</span><span class="o">.</span><span class="na">connections</span><span class="o">.</span><span class="na">size</span><span class="o">()-</span><span class="mi">1</span><span class="o">;</span> <span class="n">conni</span><span class="o">&gt;=</span><span class="mi">0</span><span class="o">;</span> <span class="n">conni</span><span class="o">--)</span> <span class="o">{</span>
                        <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">ConnectionRecord</span><span class="o">&gt;</span> <span class="n">clist</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="na">connections</span><span class="o">.</span><span class="na">valueAt</span><span class="o">(</span><span class="n">conni</span><span class="o">);</span>
                        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">clist</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                            <span class="n">ConnectionRecord</span> <span class="n">c</span> <span class="o">=</span> <span class="n">clist</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                            <span class="k">if</span> <span class="o">(!</span><span class="n">filter</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">binding</span><span class="o">.</span><span class="na">intent</span><span class="o">.</span><span class="na">intent</span><span class="o">))</span> <span class="o">{</span>
                                <span class="k">continue</span><span class="o">;</span>
                            <span class="o">}</span>
                            <span class="k">try</span> <span class="o">{</span>
                            	<span class="c1">// 执行这里，最终会调用到App A的onServiceConnected()</span>
                                <span class="n">c</span><span class="o">.</span><span class="na">conn</span><span class="o">.</span><span class="na">connected</span><span class="o">(</span><span class="n">r</span><span class="o">.</span><span class="na">name</span><span class="o">,</span> <span class="n">service</span><span class="o">);</span>
                            <span class="o">}</span> <span class="k">catch</span> <span class="o">...</span>
                        <span class="o">}</span>
                    <span class="o">}</span>
                <span class="o">}</span>

                <span class="n">serviceDoneExecutingLocked</span><span class="o">(</span><span class="n">r</span><span class="o">,</span> <span class="n">mDestroyingServices</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">r</span><span class="o">),</span> <span class="kc">false</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
            <span class="n">Binder</span><span class="o">.</span><span class="na">restoreCallingIdentity</span><span class="o">(</span><span class="n">origId</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
</code></pre></div></div>

<p>至此，App A绑定App B的MyService的流程就介绍完了。
接下来，App C要绑定App B的MyService了。</p>

<h1 id="3-app-c绑定app-b的服务myservice"><strong>3. App C绑定App B的服务MyService</strong></h1>

<p><strong>注意</strong>，此时App B的服务MyService已经被App A绑定过了。</p>

<p>执行流程大致是这样的：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bindService</span><span class="o">()</span> <span class="err">@</span> <span class="n">ContextImpl</span>
<span class="o">-&gt;</span> <span class="n">bindService</span><span class="o">()</span> <span class="err">@</span> <span class="n">AMS</span>
<span class="o">-&gt;</span> <span class="n">bindServiceLocked</span><span class="o">()</span> <span class="err">@</span> <span class="n">ActiveServices</span>
<span class="o">-&gt;</span> <span class="n">retrieveServiceLocked</span><span class="o">()</span> <span class="err">@</span> <span class="n">ActiveServices</span>
<span class="err">这里与</span><span class="n">App</span> <span class="n">A</span><span class="err">绑定服务时有区别。</span><span class="n">App</span> <span class="n">A</span><span class="err">执行时，将创建的</span><span class="n">ServiceRecord</span><span class="err">实例放到了</span><span class="n">ServiceMap</span><span class="err">的</span><span class="n">mServicesByName</span><span class="err">中，</span><span class="n">mServicesByName</span><span class="err">是</span><span class="n">ArrayMap</span><span class="o">&lt;</span><span class="n">ComponentName</span><span class="o">,</span> <span class="n">ServiceRecord</span><span class="o">&gt;</span><span class="err">类型的。</span>
<span class="n">App</span> <span class="n">C</span><span class="err">执行时，根据</span><span class="n">intent</span><span class="err">中的</span><span class="n">Component</span><span class="err">可以直接从</span><span class="n">mServicesByName</span><span class="err">中获取</span><span class="n">ServiceRecord</span><span class="err">。</span>

<span class="o">-&gt;</span> <span class="n">AppBindRecord</span> <span class="n">b</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="na">retrieveAppBindingLocked</span><span class="o">(</span><span class="n">service</span><span class="o">,</span> <span class="n">callerApp</span><span class="o">);</span>
<span class="err">参数</span><span class="n">service</span><span class="err">是</span><span class="n">intent</span><span class="err">。</span>
<span class="err">执行</span><span class="n">IntentBindRecord</span> <span class="n">i</span> <span class="o">=</span> <span class="n">bindings</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">filter</span><span class="o">);</span><span class="err">获取到</span><span class="n">App</span> <span class="n">A</span><span class="err">绑定服务时创建的</span><span class="n">IntentBindRecord</span><span class="err">实例，存入</span><span class="n">AppBindRecord</span><span class="err">中，返回给</span><span class="n">b</span><span class="err">。</span>

<span class="o">-&gt;</span> <span class="n">bringUpServiceLocked</span><span class="o">()</span>
	<span class="k">if</span> <span class="o">(</span><span class="n">r</span><span class="o">.</span><span class="na">app</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">r</span><span class="o">.</span><span class="na">app</span><span class="o">.</span><span class="na">thread</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">sendServiceArgsLocked</span><span class="o">(</span><span class="n">r</span><span class="o">,</span> <span class="n">execInFg</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>
<span class="n">r</span><span class="err">为</span><span class="n">ServiceRecord</span><span class="err">实例。</span><span class="n">r</span><span class="o">.</span><span class="na">app</span><span class="err">为</span><span class="n">ProcessRecord</span><span class="err">实例。</span>
<span class="err">这里的</span><span class="n">r</span><span class="err">是通过</span><span class="n">retrieveServiceLocked</span><span class="o">()</span><span class="err">得到的，是之前</span><span class="n">App</span> <span class="n">A</span><span class="err">绑定服务时创建的</span><span class="n">ServiceRecord</span><span class="err">实例，之前已经将</span><span class="n">r</span><span class="o">.</span><span class="na">app</span><span class="err">赋值了。</span>
<span class="err">所以，此处会执行</span><span class="k">return</span> <span class="kc">null</span><span class="err">，不会执行后面的</span><span class="n">realStartServiceLocked</span><span class="o">()</span><span class="err">。</span>

<span class="o">-&gt;</span> <span class="err">回到调用</span><span class="n">bringUpServiceLocked</span><span class="o">()</span><span class="err">方法的地方（在</span><span class="n">bindServiceLocked</span><span class="o">()</span><span class="err">中），继续执行</span><span class="n">bringUpServiceLocked</span><span class="o">()</span><span class="err">之后的代码</span>

<span class="o">-&gt;</span> <span class="err">执行下面的代码</span> <span class="err">（在</span><span class="n">bindServiceLocked</span><span class="o">()</span><span class="err">中）</span>
	<span class="k">if</span> <span class="o">(</span><span class="n">s</span><span class="o">.</span><span class="na">app</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">b</span><span class="o">.</span><span class="na">intent</span><span class="o">.</span><span class="na">received</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
        	<span class="c1">// 执行这里</span>
            <span class="n">c</span><span class="o">.</span><span class="na">conn</span><span class="o">.</span><span class="na">connected</span><span class="o">(</span><span class="n">s</span><span class="o">.</span><span class="na">name</span><span class="o">,</span> <span class="n">b</span><span class="o">.</span><span class="na">intent</span><span class="o">.</span><span class="na">binder</span><span class="o">);</span>
        <span class="o">}...</span>
        <span class="o">...</span>
    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(!</span><span class="n">b</span><span class="o">.</span><span class="na">intent</span><span class="o">.</span><span class="na">requested</span><span class="o">)</span> <span class="o">{</span>
    	<span class="c1">// 不执行这里</span>
        <span class="n">requestServiceBindingLocked</span><span class="o">(</span><span class="n">s</span><span class="o">,</span> <span class="n">b</span><span class="o">.</span><span class="na">intent</span><span class="o">,</span> <span class="n">callerFg</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
    <span class="o">}</span>
<span class="n">s</span><span class="err">为</span><span class="n">ServiceRecord</span><span class="err">实例，</span><span class="n">s</span><span class="o">.</span><span class="na">app</span><span class="err">不为</span><span class="kc">null</span><span class="err">。</span>
<span class="n">b</span><span class="o">.</span><span class="na">intent</span><span class="err">为</span><span class="n">IntentBindRecord</span><span class="err">实例，在之前执行</span><span class="n">publishService</span><span class="o">()</span><span class="err">时，将</span><span class="n">IntentBindRecord</span><span class="err">的</span><span class="n">received</span><span class="err">标志和</span><span class="n">binder</span><span class="err">赋值了。</span>
<span class="err">所以，</span><span class="n">b</span><span class="o">.</span><span class="na">intent</span><span class="o">.</span><span class="na">received</span><span class="err">为</span><span class="kc">true</span><span class="err">，</span><span class="n">b</span><span class="o">.</span><span class="na">intent</span><span class="o">.</span><span class="na">binder</span><span class="err">为有效值，是</span><span class="n">onBind</span><span class="o">()</span><span class="err">返回的</span><span class="n">binder</span><span class="err">对象。</span><span class="n">c</span><span class="o">.</span><span class="na">conn</span><span class="o">.</span><span class="na">connected</span><span class="o">(</span><span class="n">s</span><span class="o">.</span><span class="na">name</span><span class="o">,</span> <span class="n">b</span><span class="o">.</span><span class="na">intent</span><span class="o">.</span><span class="na">binder</span><span class="o">)</span><span class="err">将会执行到。</span>
<span class="n">c</span><span class="o">.</span><span class="na">conn</span><span class="o">.</span><span class="na">connected</span><span class="o">()</span><span class="err">最终会调用到</span><span class="n">App</span> <span class="n">C</span><span class="err">的</span><span class="n">onServiceConnected</span><span class="o">()</span><span class="err">。</span>
</code></pre></div></div>

<p>至此，App C绑定App B的MyService的流程结束。
可以看到App C绑定服务的流程中，没有再调用MyService的onBind()。</p>

<h1 id="4-总结"><strong>4. 总结</strong></h1>

<p>简略概括一下App A和App C绑定App B的MyService的流程，如下：</p>

<p>第一次App A绑定Service时，创建了IntentBindRecord实例，并记录在AppBindRecord中。
执行onBind()后，App B进程通过publishService()将binder传给了AMS，记录在IntentBindRecord实例中，并设置标志位received。</p>

<p>第二次App C绑定Service时，获取之前的IntentBindRecord实例，判断标志位received为true，则直接调用App C的onServiceConnected()将binder对象传给App C。
所以第二次没有调用onBind()。</p>

<p><strong>继续阅读</strong></p>

<p><a href="http://blog.csdn.net/u013553529/article/details/54698123">《Android中bindService的细节之一：从进程的角度分析绑定Service的流程【Service所在进程首次启动】》</a></p>

<p><a href="http://blog.csdn.net/u013553529/article/details/54698123">《Android中bindService的细节之二：从进程的角度分析绑定Service的流程【Service所在进程已存在】》</a></p>

</div>

<div >
	（全文完）
</div>

<div>
	 <br><br>
	 版权声明： <br>
	 本文为  原创文章，转载请注明出处，请勿用于任何商业用途。
	 <br>
	 本站原创作品采用 <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">知识共享 署名-非商业性使用-禁止演绎 4.0 国际许可协议（CC BY-NC-ND 4.0）</a> 进行许可。
</div>

<div id="related">
	<br><br>
  <h2>Related Posts</h2>
    <ul class="posts">
	    
        <li><span>31 Dec 2017</span> &raquo; <a href="/blog/2017/12/31/bye2017-hi2018">2017年，再见～，2018年，你好～</a></li>
	    
        <li><span>13 Sep 2017</span> &raquo; <a href="/blog/2017/09/13/being-towards-death">向死而生——早一点思考如何过这一生</a></li>
	    
        <li><span>13 Sep 2017</span> &raquo; <a href="/blog/2017/09/13/vipkid-experience">VIPKID 心得和经验——花同样多的钱，追求的是效果</a></li>
	    
        <li><span>19 Aug 2017</span> &raquo; <a href="/blog/2017/08/19/blog-overview">为博文分个类——”给孩子推荐书”，“和孩子讲道理”，”我的教育观”</a></li>
	    
        <li><span>03 May 2017</span> &raquo; <a href="/blog/2017/05/03/think-more-about-parenting">亲子教育要多思考</a></li>
	    
	</ul>
</div>

</article>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading"></h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li></li>
          <li><a href="mailto:"></a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          

          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p></p>
      </div>
    </div>

  </div>

  <div class="site-footer-below">
    Powered by <a href="http://jekyllrb.com">jekyll</a> <a href="https://pages.github.com/">GitHub Pages</a>.
    <span class="site-footer-year"> 2016 - 2018 </span>
    <span itemprop="name"><a href="http://localhost:4000/about"> http://localhost:4000 </a></span>
  </div>
</footer>

    

    

  </body>

</html>
